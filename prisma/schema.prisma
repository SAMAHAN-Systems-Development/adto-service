generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model OrganizationParent {
  id                   String              @id @default(cuid())
  name                 String
  description          String
  organizationChildren OrganizationGroup[]
}

model OrganizationGroup {
  organizationParentId String
  organizationChildId  String
  organizationChild    OrganizationChild  @relation(fields: [organizationChildId], references: [id])
  organizationParent   OrganizationParent @relation(fields: [organizationParentId], references: [id])

  @@id([organizationParentId, organizationChildId])
}

model OrganizationChild {
  id                  String              @id @default(cuid())
  name                String
  acronym             String?
  icon                String?
  description         String?
  facebook            String?
  instagram           String?
  twitter             String?
  linkedin            String?
  isAdmin             Boolean             @default(false)
  userId              String?             @unique
  isArchived          Boolean             @default(false)
  events              Event[]
  user                User?               @relation(fields: [userId], references: [id])
  organizationParents OrganizationGroup[]
}

model Course {
  id     String   @id @default(cuid())
  name   String
  booker Booker[]
}

model User {
  id             String             @id @default(cuid())
  email          String             @unique
  password       String
  bookerId       String?
  organizationId String?
  userType       UserType
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  booker         Booker?
  organization   OrganizationChild?
}

model Booker {
  id            String         @id @default(uuid())
  contactNumber String
  validId       String?
  courseId      String
  isAlumni      Boolean
  batch         Int?
  userId        String?        @unique
  course        Course         @relation(fields: [courseId], references: [id])
  user          User?          @relation(fields: [userId], references: [id])
  registrations Registration[]
}

model Payment {
  id             String       @id @default(cuid())
  amount         Float
  currency       String
  paymentDate    DateTime     @default(now())
  registrationId String       @unique
  registration   Registration @relation(fields: [registrationId], references: [id])
}

model Registration {
  id               String         @id @default(cuid())
  bookerId         String
  eventId          String
  confirmedAt      DateTime?
  isAttended       Boolean        @default(false)
  ticketCategoryId String
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  payment          Payment?
  booker           Booker         @relation(fields: [bookerId], references: [id])
  event            Event          @relation(fields: [eventId], references: [id])
  ticketCategory   TicketCategory @relation(fields: [ticketCategoryId], references: [id])
}

model TicketCategory {
  id                   String         @id @default(cuid())
  name                 String
  description          String
  price                Float
  capacity             Int
  registrationDeadline DateTime
  eventId              String
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
  registrations        Registration[]
  event                Event          @relation(fields: [eventId], references: [id])
}

model Event {
  id                     String               @id @default(cuid())
  name                   String
  description            String
  dateStart              DateTime
  dateEnd                DateTime
  isRegistrationOpen     Boolean              @default(false)
  isRegistrationRequired Boolean              @default(true)
  isOpenToOutsiders      Boolean              @default(false)
  orgId                  String
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  deletedAt              DateTime?
  isPublished            Boolean              @default(false)
  isArchived             Boolean              @default(false)
  org                    OrganizationChild    @relation(fields: [orgId], references: [id])
  eventAnnouncements     EventAnnouncements[]
  registrations          Registration[]
  ticketCategories       TicketCategory[]
}

model EventAnnouncements {
  id               String           @id @default(cuid())
  eventId          String
  announcementType AnnouncementType
  title            String
  content          String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  event            Event            @relation(fields: [eventId], references: [id])
}

enum UserType {
  ADMIN
  ORGANIZATION
  USER
}

enum AnnouncementType {
  INFO
  WARNING
  CANCELLED
}
