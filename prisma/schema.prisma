// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DB_URL")
  directUrl = env("DIRECT_URL")
}

enum UserType {
  ADMIN
  ORGANIZATION
  USER
}

enum AnnouncementType {
  INFO
  WARNING
  CANCELLED
}

enum AssetType {
  EVENT_THUMBNAIL
  EVENT_BANNER
  TICKET_THUMBNAIL
  TICKET_BACKGROUND
}

model OrganizationParent {
  id                   String              @id @default(cuid())
  name                 String
  description          String
  organizationChildren OrganizationGroup[]
}

model OrganizationGroup {
  organizationParentId String
  organizationParent   OrganizationParent @relation(fields: [organizationParentId], references: [id])
  organizationChildId  String
  organizationChild    OrganizationChild  @relation(fields: [organizationChildId], references: [id])

  @@id([organizationParentId, organizationChildId])
}

model OrganizationChild {
  id                  String              @id @default(cuid())
  name                String
  acronym             String?
  icon                String?
  description         String?
  facebook            String?
  instagram           String?
  twitter             String?
  linkedin            String?
  isAdmin             Boolean             @default(false)
  isArchived          Boolean             @default(false)
  userId              String?             @unique
  user                User?               @relation(fields: [userId], references: [id])
  events              Event[]
  organizationParents OrganizationGroup[]
}

model User {
  id             String             @id @default(cuid())
  email          String             @unique
  password       String
  bookerId       String?
  organization   OrganizationChild?
  organizationId String?
  userType       UserType
  isActive       Boolean            @default(true)
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
}

model Registration {
  id               String         @id @default(cuid())
  fullName         String
  email            String
  yearLevel        String
  course           String
  cluster          String
  confirmedAt      DateTime?
  isAttended       Boolean        @default(false)
  ticketCategoryId String
  ticketCategory   TicketCategory @relation(fields: [ticketCategoryId], references: [id])
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
}

model TicketCategory {
  id                   String         @id @default(cuid())
  name                 String
  description          String
  price                Float
  capacity             Int
  registrationDeadline DateTime
  eventId              String
  event                Event          @relation(fields: [eventId], references: [id])
  registrations        Registration[]
  eventAssets          EventAssets[]
  createdAt            DateTime       @default(now())
  updatedAt            DateTime       @updatedAt
}

model Event {
  id                     String               @id @default(cuid())
  name                   String
  description            String
  dateStart              DateTime
  dateEnd                DateTime
  isRegistrationOpen     Boolean              @default(false) // Registration can be published but not open
  isRegistrationRequired Boolean              @default(true) // Some registrations are open to public without registration
  isOpenToOutsiders      Boolean              @default(false) // Event is open to outsiders
  isPublished            Boolean              @default(false) // Event can be created but not published
  isArchived             Boolean              @default(false) // Event is archived
  orgId                  String
  org                    OrganizationChild    @relation(fields: [orgId], references: [id])
  portalRequests         PortalRequests[]
  TicketCategories       TicketCategory[]
  eventAnnouncements     EventAnnouncements[]
  assets                 EventAssets[]

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
}

model EventAnnouncements {
  id               String           @id @default(cuid())
  eventId          String
  event            Event            @relation(fields: [eventId], references: [id])
  announcementType AnnouncementType
  title            String
  content          String
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
}

model EventAssets {
  id               String          @id @default(uuid())
  event            Event           @relation(fields: [eventId], references: [id])
  eventId          String
  ticketCategory   TicketCategory? @relation(fields: [ticketCategoryId], references: [id])
  ticketCategoryId String?
  assetType        AssetType
  imageUrl         String
  mimeType         String
  fileSize         Int
  uploadedAt       DateTime        @default(now())

  @@unique([eventId, assetType])
}

model PortalRequests {
  id         String   @id @default(cuid())
  eventId    String
  event      Event    @relation(fields: [eventId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  isApproved Boolean  @default(false)
  portalLink String?
}
